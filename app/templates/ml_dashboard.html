{% extends 'layout.html' %}
{% load static %}

{% block content %}

<div class="card p-4 shadow-sm">

    <h3 class="mb-4">üìà Predicci√≥n de ventas ‚Äî Pr√≥ximos 30 d√≠as</h3>

    <!-- Selector de producto -->
    <form method="get">
        <label>Selecciona producto:</label>
        <select name="product_id" onchange="this.form.submit()" class="form-control w-25">
            {% for p in products %}
                <option value="{{ p.product_id }}"
                    {% if p.product_id == product_id %}selected{% endif %}>
                    {{ p.product_name }} ({{ p.product_id }})
                </option>
            {% endfor %}
        </select>
    </form>

    <br>

    <!-- Gr√°fico 1 -->
    <div id="chart_30" style="height: 430px;"></div>

    <hr class="my-4">

    <!-- Gr√°fico 2: IDI -->
    <h3 class="mt-4">üì¶ Duraci√≥n del Inventario (IDI) ‚Äî Real y Proyecci√≥n ML</h3>
    <div id="chart_idi" style="height: 430px;"></div>

</div>

<!-- Highcharts -->
<script src="https://code.highcharts.com/highcharts.js"></script>

<!-- =============================
     GR√ÅFICO 1 ‚Äî Predicci√≥n de ventas
============================== -->
<script>
Highcharts.chart('chart_30', {
    chart: { type: 'line' },
    title: { text: 'Predicci√≥n de ventas (30 d√≠as)' },

    xAxis: {
        categories: {{ dates|safe }},
        labels: { rotation: -45 }
    },

    yAxis: {
        title: { text: 'Unidades vendidas' }
    },

    series: [{
        name: 'Predicci√≥n ML',
        data: {{ values|safe }},
        color: '#007bff',
        marker: { radius: 4 }
    }]
});
</script>

<!-- =============================
     GR√ÅFICO 2 ‚Äî IDI real + Proyecci√≥n
============================== -->
<script>
Highcharts.chart('chart_idi', {
    chart: { type: 'line' },
    title: { text: 'Duraci√≥n del Inventario (IDI)' },

    xAxis: {
        categories: {{ idi_hist_dates|safe }}.concat({{ idi_future_dates|safe }}),
        labels: { rotation: -45 }
    },

    yAxis: {
        title: { text: 'D√≠as de duraci√≥n' }
    },

    series: [
        {
            name: 'IDI Hist√≥rico',
            data: {{ idi_hist_values|safe }},
            color: '#ff4d4d',
            marker: { radius: 3 }
        },
        {
            name: 'IDI Proyectado (ML)',
            data: {{ idi_future_values|safe }},
            color: '#ff99cc',
            dashStyle: 'ShortDash',
            marker: { radius: 3 }
        }
    ]
});
</script>

{% endblock %}


